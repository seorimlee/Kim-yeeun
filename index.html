<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Section Background Scroll Effect</title>
    <style>
        *, *:after, *:before {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #fff;
            color: #000;
            overflow-x: hidden;
        }

        /* 섹션 기본 스타일 */
        .parallax_section {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background-size: cover;  /* 배경 이미지 크기 항상 유지 */
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh; /* 화면 전체 높이로 설정 */
        }

        .parallax_section h2 {
            color: #fff;
            font-size: 4rem;
            text-align: center;
            z-index: 1;
        }

        /* 각 섹션에 고유 배경 이미지 추가 */
        .section1 {
            background-image: url('section1.jpg');
        }

        .section2 {
            background-image: url('section2.jpg');
        }

        .section3 {
            background-image: url('section3.jpg');
        }

        /* 모바일에서의 추가 최적화 */
        @media (max-width: 768px) {
            .parallax_section h2 {
                font-size: 2rem; /* 모바일에서는 텍스트 크기 조정 */
            }

            .parallax_section {
                width: 100%;
                height: 100vh;
            }
        }

    </style>
</head>

<body>
    <div class="parallax_section section1">
        <h2>CSS2 <br> Parallax Effect</h2>
    </div>
    <div class="parallax_section section2">
        <h2>CSS3 <br> Parallax Effect</h2>
    </div>
    <div class="parallax_section section3">
        <h2>CSS3 <br> Parallax Effect</h2>
    </div>

    <script>
        // 화면 크기에 따라 섹션의 높이를 설정
        function setSectionHeight() {
            const sections = document.querySelectorAll('.parallax_section');
            const viewportHeight = window.innerHeight;

            sections.forEach(section => {
                section.style.height = `${viewportHeight}px`; // 동적으로 각 섹션의 높이를 설정
            });
        }

        function updateParallax() {
            const parallaxSections = document.querySelectorAll('.parallax_section');
            const scrollPosition = window.pageYOffset;

            // 화면 전체 높이
            const viewportHeight = window.innerHeight;

            parallaxSections.forEach((section, index) => {
                const speed = (index + 1) * 0.2; // 섹션별 속도
                let offset = scrollPosition * speed; // 스크롤 위치에 따른 이동 값 계산

                // 각 섹션의 배경 이동
                section.style.backgroundPosition = `center ${-offset}px`;

                // 마지막 섹션의 배경 이미지가 화면 끝에서 중앙에 위치하도록
                if (index === parallaxSections.length - 1) {
                    const sectionHeight = section.offsetHeight;
                    const scrollThreshold = sectionHeight - viewportHeight;

                    // 마지막 섹션에서 스크롤 끝까지 내려갔을 때 배경 이미지가 중앙에 위치하도록 처리
                    if (scrollPosition >= scrollThreshold) {
                        section.style.backgroundPosition = 'center center';
                    } else {
                        // 마지막 섹션은 다른 섹션처럼 계속 Parallax 효과 적용
                        section.style.backgroundPosition = `center ${-offset}px`;
                    }
                }
            });
        }

        // 화면 리사이즈나 페이지 로딩 시 섹션 높이 재설정
        window.addEventListener('resize', setSectionHeight);

        // 스크롤 이벤트 최적화
        window.addEventListener('scroll', function () {
            requestAnimationFrame(updateParallax);
        });

        // 페이지 로딩 시 초기 설정
        window.addEventListener('load', function () {
            setSectionHeight();  // 초기 높이 설정
            updateParallax();    // 초기 배경 업데이트
        });
    </script>
</body>

</html>
